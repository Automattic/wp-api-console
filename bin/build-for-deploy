#!/bin/bash

BASE_DIR=$(dirname "$0")
cd $BASE_DIR/../

# Build the console
cp src/config.prod.json config.json
npm run build

# Copy the builded files
mkdir -p build-theme
rm -rf build-theme/*
cp -aR build build-theme/console3
cp -aR theme/* build-theme

# Generate the custom theme template
JS_FILENAME=$(basename $(find $BASE_DIR/../build/static/js/ -name \*.js -print))
CSS_FILENAME=$(basename $(find $BASE_DIR/../build/static/css/ -name \*.css -print))
sed -i '' 's/<css>/'$CSS_FILENAME'/g' build-theme/console3.php
sed -i '' 's/<js>/'$JS_FILENAME'/g' build-theme/console3.php
